# -*- coding: utf-8 -*-
"""02_exercise.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1d6nBo_yuDTHvnCNVwAOvfPZCfh5YQ94a

# æ¼”ç¿’
ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®è¨­å®šã‚’ã€Streamlit Community Cloudã®ã€ŒSecretsã€ã«ä¿å­˜ã—ã¾ã—ã‚‡ã†ã€‚

## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ï¼ˆâ€»æ³¨: ã“ã®ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯å†…ã§ã“ã‚Œã‚‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã“ã¨ã¯ç„¡ã„ã®ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ï¼‰
"""

# !pip install streamlit==1.20.0 --quiet
# !pip install openai

# import streamlit as st
# import openai

"""## ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®ã‚³ãƒ¼ãƒ‰
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã®`st.secrets.AppSettings.chatbot_setting`ã§ã€Œsystemã€ã®è¨­å®šãŒã§ãã‚‹ã‚ˆã†ã«ã€Streamlit Community Cloudã®ã€ŒSecretsã€ã«è¿½è¨˜ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚  
"""

# Commented out IPython magic to ensure Python compatibility.
# %%writefile app.py
# 
# import streamlit as st
# import openai
# 
# # Streamlit Community Cloudã®ã€ŒSecretsã€ã‹ã‚‰OpenAI API keyã‚’å–å¾—
# openai.api_key = st.secrets.OpenAIAPI.openai_api_key
# 
# # st.session_stateã‚’ä½¿ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚„ã‚Šã¨ã‚Šã‚’ä¿å­˜
# if "messages" not in st.session_state:
#     st.session_state["messages"] = [
#         {"role": "system", "content": st.secrets.AppSettings.chatbot_setting}
#         ]
# 
# # ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã¨ã‚„ã‚Šã¨ã‚Šã™ã‚‹é–¢æ•°
# def communicate():
#     messages = st.session_state["messages"]
# 
#     user_message = {"role": "user", "content": st.session_state["user_input"]}
#     messages.append(user_message)
# 
#     response = openai.ChatCompletion.create(
#         model="gpt-3.5-turbo",
#         messages=messages
#     )
# 
#     bot_message = response["choices"][0]["message"]
#     messages.append(bot_message)
# 
#     st.session_state["user_input"] = ""  # å…¥åŠ›æ¬„ã‚’æ¶ˆå»
# 
# 
# # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã®æ§‹ç¯‰
# st.title("My AI Assistant")
# st.write("ChatGPT APIã‚’ä½¿ã£ãŸãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã§ã™ã€‚")
# 
# user_input = st.text_input("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚", key="user_input", on_change=communicate)
# 
# if st.session_state["messages"]:
#     messages = st.session_state["messages"]
# 
#     for message in reversed(messages[1:]):  # ç›´è¿‘ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸Šã«
#         speaker = "ğŸ™‚"
#         if message["role"]=="assistant":
#             speaker="ğŸ¤–"
# 
#         st.write(speaker + ": " + message["content"])

"""## requirements.txtã®ä½œæˆ"""

# Commented out IPython magic to ensure Python compatibility.
# %%writefile requirements.txt
# streamlit==1.20.0
# openai

"""ä»¥ä¸‹ã®ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€æ–°ãŸãªGitHubã®ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ã—ã¾ã—ã‚‡ã†ã€‚
* app.py
* requirements.txt
  
Streamlit Community Cloudä¸Šã§å‹•ä½œã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## è§£ç­”ä¾‹
ä»¥ä¸‹ã¯è§£ç­”ä¾‹ã§ã™ã€‚  
ä»¥ä¸‹ã®ã‚ˆã†ãªè¨˜è¿°ã‚’ã€ŒSecretsã€ã«è¿½è¨˜ã—ã¾ã™ã€‚

[AppSettings]  
chatbot_setting = "ã‚ãªãŸã¯å„ªç§€ãªè‹±èªæ•™å¸«ã§ã™ã€‚ä½•ã‚’èã‹ã‚Œã¦ã‚‚è‹±èªã§ç­”ãˆã¦ãã ã•ã„ã€‚"
"""